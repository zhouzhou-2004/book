<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<!-- 字体图标 -->
	<link href="/javaex/pc/css/icomoon.css" rel="stylesheet" />
	<!-- 动画 -->
	<link href="/javaex/pc/css/animate.css" rel="stylesheet" />
	<!-- 骨架样式 -->
	<link href="/javaex/pc/css/common.css" rel="stylesheet" />
	<!-- 皮肤（缇娜） -->
	<link href="/javaex/pc/css/skin/tina.css" rel="stylesheet" />
	<!-- jQuery -->
	<script src="/javaex/pc/lib/jquery-1.7.2.min.js"></script>
	<!-- 核心组件 -->
	<script src="/javaex/pc/js/javaex.min.js"></script>
	<title>图书信息</title>
</head>


<body>
<div class="list-content">
	<div class="block">
		<h2>图书信息列表</h2>
		<div class="main">
			<!--搜索框-->
			<div class="input-group">
				<input id="searchInput" type="text" class="text" style="width: 400px" placeholder="请输入书名搜索" />
				<button class="button blue" onclick="searchBooks()">搜索</button>
			</div>

			<!--表格-->
			<table id="booksTable" class="table color2">
				<thead>
				<tr>
					<th>序号</th>
					<th>书名</th>
					<th>作者</th>
					<th>ISBN</th>
					<th>页数</th>
					<th>定价</th>
					<th>出版社</th>
					<th>出版时间</th>
					<th>库存数量</th>
					<th>分类</th>
					<th>操作</th>  <!-- 新增操作列 -->
				</tr>
				</thead>
				<tbody>
				<!-- 图书数据将在这里动态加载 -->
				</tbody>
			</table>
		</div>
	</div>
</div>
</body>
</html>

<!--注入axios-->
<script src="/borrow/js/axios.min.js"></script>
<script>
	// 页面加载时执行查询
	window.onload = function() {
		loadBooks();
	};

	// 加载所有图书
	function loadBooks() {
		// 发送 axios 请求，查询所有图书信息
		axios({
			url: "/borrow/select",
			method: "post"
		}).then((response) => {
			console.log('接收到的响应数据：', response);
			displayBooks(response);
		}).catch((error) => {
			console.error('请求失败：', error);
		});
	}

	// 搜索图书
	function searchBooks() {
		const keyword = document.getElementById('searchInput').value.trim();
		if (!keyword) {
			console.log('请输入搜索关键词');
			return;
		}

		// 发送搜索请求
		axios({
			url: "/borrow/search",
			method: "post",
			data: { keyword: keyword }
		}).then((response) => {
			console.log('搜索结果：', response);
			displayBooks(response);
		}).catch((error) => {
			console.error('搜索失败：', error);
		});
	}

	// 显示图书数据
	function displayBooks(response) {
		// 检查响应是否包含数据
		if (response.data.data && response.data.data.length > 0) {
			const data = response.data.data;
			const tableBody = document.querySelector('#booksTable tbody');

			// 清空现有的表格内容
			tableBody.innerHTML = '';

			// 循环遍历数据并添加到表格
			data.forEach((book, index) => {
				const row = document.createElement('tr');
				row.align = 'center';

				// 创建序号单元格
				const indexCell = document.createElement('td');
				indexCell.textContent = index + 1;
				row.appendChild(indexCell);

				// 创建书名单元格
				const nameCell = document.createElement('td');
				nameCell.textContent = book.name;
				row.appendChild(nameCell);

				// 创建作者单元格
				const authorCell = document.createElement('td');
				authorCell.textContent = book.author;
				row.appendChild(authorCell);

				// 创建ISBN单元格
				const isbnCell = document.createElement('td');
				isbnCell.textContent = book.isbn;
				row.appendChild(isbnCell);

				// 创建页数单元格
				const pagesCell = document.createElement('td');
				pagesCell.textContent = book.pages;
				row.appendChild(pagesCell);

				// 创建定价单元格
				const priceCell = document.createElement('td');
				priceCell.textContent = book.price;
				row.appendChild(priceCell);

				// 创建出版社单元格
				const publishCell = document.createElement('td');
				publishCell.textContent = book.publish;
				row.appendChild(publishCell);

				// 创建出版时间单元格
				const publishTimeCell = document.createElement('td');
				publishTimeCell.textContent = book.publishTime;
				row.appendChild(publishTimeCell);

				// 创建库存数量单元格
				const sizeCell = document.createElement('td');
				sizeCell.textContent = book.size;
				row.appendChild(sizeCell);

				// 创建分类单元格
				const typeCell = document.createElement('td');
				typeCell.textContent = book.type;
				row.appendChild(typeCell);

				// 创建操作单元格
				const actionsCell = document.createElement('td');

				// 创建编辑按钮
				const editButton = document.createElement('button');
				editButton.textContent = '编辑';
				editButton.className = 'button blue';
				editButton.style.marginRight = '5px';
				editButton.onclick = () => editBook(book);

				// 创建删除按钮
				const deleteButton = document.createElement('button');
				deleteButton.textContent = '删除';
				deleteButton.className = 'button red';
				deleteButton.onclick = () => deleteBook(book.id);

				// 将按钮添加到操作单元格
				actionsCell.appendChild(editButton);
				actionsCell.appendChild(deleteButton);
				row.appendChild(actionsCell);

				// 将新行添加到表格主体
				tableBody.appendChild(row);
			});
		} else {
			console.log('没有图书数据或数据为空');
			const tableBody = document.querySelector('#booksTable tbody');
			tableBody.innerHTML = '';
		}
	}

	// 编辑图书
	function editBook(book) {
		console.log('编辑图书：', book);
		// 发送编辑请求
		axios({
			url: "/borrow/update",
			method: "post",
			data: book
		}).then((response) => {
			console.log('编辑成功：', response);
			loadBooks(); // 重新加载数据
		}).catch((error) => {
			console.error('编辑失败：', error);
		});
	}

	// 删除图书
	function deleteBook(bookId) {
		console.log('删除图书：', bookId);
		if (confirm('确定要删除这本图书吗？')) {
			// 发送删除请求
			axios({
				url: "/borrow/delete",
				method: "post",
				data: { id: bookId }
			}).then((response) => {
				console.log('删除成功：', response);
				loadBooks(); // 重新加载数据
			}).catch((error) => {
				console.error('删除失败：', error);
			});
		}
	}

	// 添加回车搜索功能
	document.getElementById('searchInput').addEventListener('keypress', function(e) {
		if (e.key === 'Enter') {
			searchBooks();
		}
	});
</script>