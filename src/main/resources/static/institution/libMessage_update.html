<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta charset="utf-8">
    <!-- 字体图标 -->
    <link href="/javaex/pc/css/icomoon.css" rel="stylesheet" />
    <!-- 动画 -->
    <link href="/javaex/pc/css/animate.css" rel="stylesheet" />
    <!-- 骨架样式 -->
    <link href="/javaex/pc/css/common.css" rel="stylesheet" />
    <!-- 皮肤（缇娜） -->
    <link href="/javaex/pc/css/skin/tina.css" rel="stylesheet" />
    <!-- jQuery -->
    <script src="/javaex/pc/lib/jquery-1.7.2.min.js"></script>
    <!-- 全局动态修改 -->
    <script src="/javaex/pc/js/common.js"></script>
    <!-- 核心组件 -->
    <script src="/javaex/pc/js/javaex.min.js"></script>
    <!-- 表单验证 -->
    <script src="/javaex/pc/js/javaex-formVerify.js"></script>
    <title>后台管理</title>
    <style>
        /* 全局样式重置与基础设置 */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f4f9fc; /* 淡蓝色清新背景 */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* 内容区域样式，整体更简洁清爽 */
        .list-content {
            width: 80%;
            max-width: 1000px;
            padding: 20px;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); /* 柔和阴影效果 */
        }

        /* 块元素样式，优化交互反馈 */
        .block {
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .block:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* 标题样式，更简洁优雅 */
        .banner {
            border-bottom: 1px solid #e1e9f0; /* 淡灰色边框 */
            padding-bottom: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .banner p.tab.fixed {
            font-size: 24px;
            font-weight: bold;
            color: #1e88e5; /* 主题蓝色标题文字 */
        }

        /* 表单样式，提升输入舒适度与视觉一致性 */
        form {
            width: 100%;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #444;
            font-size: 16px;
        }

        input[type="text"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid #d8d8d8;
            border-radius: 4px;
            box-sizing: border-box;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            font-size: 14px;
            background-color: #f9f9f9;
        }

        input[type="text"]:focus {
            border-color: #1e88e5; /* 聚焦时边框变为主题蓝色 */
            outline: none;
            box-shadow: 0 0 6px rgba(30, 136, 229, 0.25);
        }

        /* 按钮样式，采用纯色背景搭配阴影，简约现代 */
        .unit.clear {
            text-align: center;
            margin-top: 20px;
        }

        .button {
            border: none;
            border-radius: 4px;
            padding: 12px 30px;
            cursor: pointer;
            font-size: 16px;
            margin: 0 10px;
            transition: background-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
            background-color: #1e88e5; /* 主题蓝色按钮背景 */
            color: white;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            background-color: #1976d2; /* 鼠标悬停时加深背景色 */
        }

        .button:active {
            transform: translateY(1px); /* 点击时微微下沉，模拟物理反馈 */
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .button.no {
            background-color: #ccc; /* 灰色返回按钮背景 */
        }

        .button.no:hover {
            background-color: #b3b3b3; /* 悬停时加深灰色背景 */
        }

        .button.no:active {
            transform: translateY(1px);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body>
<div class="list-content">
    <!--块元素-->
    <div class="block">
        <!--修饰块元素名称-->
        <div class="banner">
            <p class="tab fixed">图书馆信息编辑</p>
        </div>

        <!--正文内容-->
        <div class="main">
            <form id="libraryInfoForm">
                <label for="libraryName">图书馆名称：</label>
                <input type="text" id="libraryName" /> <br />
                <label for="address">地址：</label>
                <input type="text" id="address" /> <br />
                <label for="openTime">开放时间：</label>
                <input type="text" id="openTime" /> <br />
                <label for="contactPhone">联系电话：</label>
                <input type="text" id="contactPhone" /> <br />
                <!--提交按钮-->
                <div class="unit.clear">
                    <div style="text-align: center;">
                        <!--表单提交时，必须是input元素，并指定type类型为button，否则ajax提交时，会返回error回调函数-->
                        <input type="button" id="return" class="button no" value="返回" />
                        <input type="button" id="save" class="button true" value="保存" />
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="/js/axios.min.js"></script>

<script>

    // 页面加载时获取URL参数并填充表单
    document.addEventListener('DOMContentLoaded', function() {
        // 获取URL中的参数
        const urlParams = new URLSearchParams(window.location.search);

        // 获取各个参数值
        const libraryName = urlParams.get('libraryName');
        const address = urlParams.get('address');
        const openTime = urlParams.get('openTime');
        const contactPhone = urlParams.get('contactPhone');

        // 将值填充到表单中
        document.getElementById('libraryName').value = libraryName || '';
        document.getElementById('address').value = address || '';
        document.getElementById('openTime').value = openTime || '';
        document.getElementById('contactPhone').value = contactPhone || '';
    });

    <!--编辑图书馆信息-->
    // 获取返回按钮和保存按钮元素
    const returnButton = document.getElementById('return');
    const saveButton = document.getElementById('save');

    //为返回添加点击事件监听器
    returnButton.addEventListener('click', function () {
        // 跳转到编辑页面
        window.location.href = 'libMessage.html';
    });

    // 点击保存按钮的事件处理函数事件
    saveButton.addEventListener('click',function () {
        // 获取表单输入的值
        const libraryName = document.getElementById('libraryName').value;
        const address = document.getElementById('address').value;
        const openTime = document.getElementById('openTime').value;
        const contactPhone = document.getElementById('contactPhone').value;
        // 校验文本
        if (libraryName === "") {
            javaex.optTip({
                content: "图书馆名称不能为空!",
                type: "error"
            });
            return false;
        }
        if (address === "") {
            javaex.optTip({
                content: "地址不能为空!",
                type: "error"
            });
            return false;
        }
        if (openTime ==="") {
            javaex.optTip({
                content: "开放时间不能为空",
                type: "error"
            });
            return false;
        }
        if (contactPhone === "") {
            javaex.optTip({
                content: "联系电话不能为空!",
                type: "error"
            });
            return false;
        }

        // 禁用保存按钮防止重复提交
        saveButton.disabled = true;

        // 使用完整的axios函数调用形式发送POST请求
        axios({
            url: 'http://localhost:8080/lib/update',
            method: 'post',
            headers: {
                // 表明发送的数据是 JSON 格式的，将构建好的 json 对象作为请求数据发送给后端。
                'Content-Type': 'application/json'
            },
            data: {
                libraryName: libraryName,
                address: address,
                openTime: openTime,
                contactPhone: contactPhone
            }
        })
            .then(function (response) {
                // 根据后端返回数据中的code属性判断操作是否成功
                if (response.data.code === 200) {
                    javaex.optTip({
                        content: "图书馆信息更新成功",
                        type: "success"
                    });
                    // 延迟跳转至列表，在1500ms之后
                    setTimeout(function () {
                        window.location.href = "libMessage.html";
                    }, 1500);
                } else {
                    // 如果失败，弹出后端返回的提示信息
                    javaex.optTip({
                        content: response.data.message || '更新失败，请检查数据',
                        type: "error"
                    });

                    // 重新启用保存按钮
                    saveButton.disabled = false;
                }
            })
            .catch(function (error) {
                console.error('提交数据出错：', error);

                // 提供错误的视觉反馈
                javaex.optTip({
                    content: "提交数据时发生错误，请稍后再试。",
                    type: "error"
                });

                // 重新启用保存按钮
                saveButton.disabled = false;
            });
    });

</script>
</body>
</html>