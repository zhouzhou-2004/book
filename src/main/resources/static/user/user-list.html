<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta charset="utf-8">
	<!-- 字体图标 -->
	<link href="/javaex/pc/css/icomoon.css" rel="stylesheet" />
	<!-- 动画 -->
	<link href="/javaex/pc/css/animate.css" rel="stylesheet" />
	<!-- 骨架样式 -->
	<link href="/javaex/pc/css/common.css" rel="stylesheet" />
	<!-- 皮肤（缇娜） -->
	<link href="/javaex/pc/css/skin/tina.css" rel="stylesheet" />
	<!-- jQuery -->
	<script src="/javaex/pc/lib/jquery-1.7.2.min.js"></script>
	<!-- 全局动态修改 -->
	<script src="/javaex/pc/js/common.js"></script>
	<!-- 核心组件 -->
	<script src="/javaex/pc/js/javaex.min.js"></script>
	<!-- 表单验证 -->
	<script src="/javaex/pc/js/javaex-formVerify.js"></script>
	<title>后台管理</title>
</head>

<body>
<!--主体内容-->
<div class="list-content">
	<!--块元素-->
	<div class="block">
		<!--页面有多个表格时，可以用于标识表格-->
		<h2>用户列表</h2>
		<!--右上角的返回按钮-->
		<a href="javascript:history.back();">
			<button class="button indigo radius-3" style="position: absolute;right: 20px;top: 16px;"><span class="icon-arrow_back"></span> 返回</button>
		</a>

		<!--正文内容-->
		<div class="main">
			<!--表格上方的搜索操作-->
			<div class="admin-search">
				<div class="input-group">
					<input id="keyword" type="text" class="text" placeholder="搜索用户名或者昵称" />
					<button id="searchBtn" class="button blue" onclick="search();">搜索</button>
				</div>
			</div>

			<!--表格上方的操作元素，添加、删除等-->
			<!--
			<div class="operation-wrap">
				<div class="buttons-wrap">
					<button class="button blue radius-3"><span class="icon-plus"></span> 添加</button>
					<button class="button red radius-3"><span class="icon-close2"></span> 删除</button>
				</div>
			</div>
			-->
			<table id="table" class="table color2">
				<thead>
				<tr align="center">
					<th>序号</th>
					<th>昵称</th>
					<th>用户名</th>
					<th>生日</th>
					<th>电话</th>
					<th>邮箱</th>
					<th>地址</th>
					<th>可借数量</th>
					<th>身份</th>
					<th>操作</th>
				</tr>
				</thead>
				<!-- 用户数据将会在这里动态加载 -->
				<tbody id="adminTable">
				<!--<tr>-->
				<!--<td class="checkbox"><input type="checkbox" class="fill listen-1-2" /> </td>-->
				<!--<td>1</td>-->
				<!--<td><button class="button blue">编辑</button><button class="button red">删除</button></td>-->
				<!--</tr>-->
				</tbody>
			</table>

			<div class="page">
				<ul id="page" class="pagination"></ul>
			</div>
		</div>
	</div>
</div>
</body>
</html>
<!--第一步：前端发送请求应该使用什么技术 axios(AJAX)-->
<script src="/js/axios.min.js"></script>
<!--第二步:通过axios发送前端请求到服务器(后端)-->
<script>
	axios({
		url: "http://localhost:8080/user/list",//请求路径
		method: "post"//请求方式
	}).then((response)=> {
		//请求成功执行
		if (response.data.code && response.data.code>0) {
			//请求成功
			const data = response.data.data;
			const tableBody = document.getElementById('#adminTable');

			// 清空现有的表格内容
			tableBody.innerHTML = '';

			// 循环遍历数据并添加到表格
			data.forEach((user, index) => {
				const row = document.createElement('tr');

				// 创建序号单元格
				const serialNumberCell = document.createElement('td');
				serialNumberCell.textContent = index + 1;
				row.appendChild(serialNumberCell);

				// 创建昵称单元格
				const nicknameCell = document.createElement('td');
				nicknameCell.textContent = user.nickname;
				row.appendChild(nicknameCell);

				// 创建用户名单元格
				const usernameCell = document.createElement('td');
				usernameCell.textContent = user.username;
				row.appendChild(usernameCell);

				// 创建生日单元格
				const birthdayCell = document.createElement('td');
				birthdayCell.textContent = user.birthday;
				row.appendChild(birthdayCell);

				// 创建电话单元格
				const phoneCell = document.createElement('td');
				phoneCell.textContent = user.phone;
				row.appendChild(phoneCell);

				// 创建邮箱单元格
				const emailCell = document.createElement('td');
				emailCell.textContent = user.email;
				row.appendChild(emailCell);

				// 创建地址单元格
				const addressCell = document.createElement('td');
				addressCell.textContent = user.address;
				row.appendChild(addressCell);

				// 创建可借数量单元格
				const borrowCountCell = document.createElement('td');
				borrowCountCell.textContent = user.borrowCount;
				row.appendChild(borrowCountCell);

				// 创建身份单元格
				const identityCell = document.createElement('td');
				identityCell.textContent = user.identity;
				row.appendChild(identityCell);

				// 创建操作单元格
				const actionsCell = document.createElement('td');

				const editButton = document.createElement('button');
				editButton.textContent = '编辑';
				editButton.className = 'edit-button';
				editButton.setAttribute('data-id', user.id);
				editButton.setAttribute('data-nickname', user.nickname);
				editButton.setAttribute('data-username', user.username);
				editButton.setAttribute('data-birthday', user.birthday);
				editButton.setAttribute('data-phone', user.phone);
				editButton.setAttribute('data-email', user.email);
				editButton.setAttribute('data-address', user.address);
				editButton.setAttribute('data-borrowCount', user.borrowCount);
				editButton.setAttribute('data-identity', user.identity);

				// 为编辑按钮添加事件监听器
				editButton.addEventListener('click', function (event) {
					event.preventDefault();
					const id = this.getAttribute('data-id');
					const nickname = this.getAttribute('data-nickname');
					const username = this.getAttribute('data-username');
					const birthday = this.getAttribute('data-birthday');
					const phone = this.getAttribute('data-phone');
					const email = this.getAttribute('data-email');
					const address = this.getAttribute('data-address');
					const borrowCount = this.getAttribute('data-borrowCount');
					const identity = this.getAttribute('data-identity');

					// 这里可以添加显示编辑模态框并填充对应数据的逻辑，示例如下（你可根据实际模态框结构完善）
					document.getElementById('editId').value = id;
					document.getElementById('editNickname').value = nickname;
					document.getElementById('editUsername').value = username;
					document.getElementById('editBirthday').value = birthday;
					document.getElementById('editPhone').value = phone;
					document.getElementById('editEmail').value = email;
					document.getElementById('editAddress').value = address;
					document.getElementById('editBorrowCount').value = borrowCount;
					document.getElementById('editIdentity').value = identity;
					document.getElementById('editModal').style.display = 'block';
				});

				const deleteButton = document.createElement('button');
				deleteButton.textContent = '删除';
				deleteButton.setAttribute('data-user-id', user.id);

				// 为删除按钮添加事件监听器
				deleteButton.addEventListener('click', function (event) {
					event.preventDefault();
					if (confirm("您确定要删除该用户吗?")) {
						const userId = event.target.getAttribute('data-user-id');

						axios({
							url: "http://localhost:8080/user/delete",
							method: "post",
							data: {
								id: userId
							}
						}).then((response) => {
							if (response.data.code == '305') {
								alert("删除用户失败");
							} else if (response.data.code == '306') {
								alert("删除用户异常，请联系管理员");
							} else {
								alert("删除用户成功");
								location.reload();
							}
						}).catch((error) => {
							alert('请求失败：' + error);
						});
					}
				});

				actionsCell.appendChild(editButton);
				actionsCell.appendChild(deleteButton);
				row.appendChild(actionsCell);

				// 将新行添加到表格主体
				tableBody.appendChild(row);
			});
		}else {
			alert('没有用户数据或数据为空');
		}
	}).catch((error) => {
		alert('请求失败：' + error);
	})
</script>